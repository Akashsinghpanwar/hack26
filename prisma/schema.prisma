generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String?
  image         String?
  
  // Car Details
  carPlateNumber  String?   // User's car registration plate
  carType         String?   // "petrol", "diesel", "hybrid", "electric"
  carEmissionFactor Float   @default(171) // g CO2/km - default diesel car
  
  // Lifestyle Goals
  walkingGoal     Int       @default(0)   // days per week goal
  cyclingGoal     Int       @default(0)   // days per week goal
  runningGoal     Int       @default(0)   // days per week goal (fast walk/jog)
  publicTransitGoal Int     @default(0)   // days using bus/train
  maxDrivingDays  Int       @default(7)   // max car days allowed per week
  
  // Health Profile
  fitnessGoal     String?   // "lose_weight", "stay_active", "build_stamina", "reduce_carbon"
  weeklyCalorieTarget Int   @default(2000) // weekly calorie burn goal
  
  // Preferences
  preferredModes  String?   // comma-separated: "bike,walk,train"
  setupCompleted  Boolean   @default(false)
  
  // Coin Reward System
  coins           Int       @default(0)     // total coins collected
  lastLoginDate   DateTime?                 // track daily login for rewards
  treesPlanted    Int       @default(0)     // trees planted when 100 coins collected
  totalCoinsEarned Int      @default(0)     // lifetime coins earned
  
  // Daily Streak Reward System
  streak          Int       @default(0)     // current login streak days
  totalLeaves     Int       @default(0)     // total leaves collected from streaks
  lastStreakDate  DateTime?                 // last date streak was updated
  
  journeys      Journey[]
  achievements  UserAchievement[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Journey {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  distance       Float    // in km
  transportMode  String   // car, bike, walk, bus, train, ebike
  travelTime     Float    // in minutes
  co2Emissions   Float    // in kg
  caloriesBurned Float
  co2Saved       Float    // vs driving
  fromLocation   String?
  toLocation     String?
  createdAt      DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model Achievement {
  id          String            @id @default(cuid())
  code        String            @unique
  name        String
  description String
  icon        String
  threshold   Float
  type        String            // co2, calories, journeys, streak
  users       UserAchievement[]
}

model UserAchievement {
  userId        String
  achievementId String
  unlockedAt    DateTime    @default(now())
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@id([userId, achievementId])
}
