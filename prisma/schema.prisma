generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String?
  image         String?
  journeys      Journey[]
  achievements  UserAchievement[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Journey {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  distance       Float    // in km
  transportMode  String   // car, bike, walk, bus, train, ebike
  travelTime     Float    // in minutes
  co2Emissions   Float    // in kg
  caloriesBurned Float
  co2Saved       Float    // vs driving
  fromLocation   String?
  toLocation     String?
  createdAt      DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model Achievement {
  id          String            @id @default(cuid())
  code        String            @unique
  name        String
  description String
  icon        String
  threshold   Float
  type        String            // co2, calories, journeys, streak
  users       UserAchievement[]
}

model UserAchievement {
  userId        String
  achievementId String
  unlockedAt    DateTime    @default(now())
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@id([userId, achievementId])
}
